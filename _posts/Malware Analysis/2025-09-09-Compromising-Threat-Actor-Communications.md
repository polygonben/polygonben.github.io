---
title: "Compromising Threat Actor Communications"
categories:
  - Malware Analysis
toc: true
---

## Introduction

Traditionally, the vast majority of malware would communicate to a threat actor owned server via a threat actor owned domain or IP address. This domain or IP would likely be hardcoded within the malware sample somewhere, such that when executed, it would reach out to establish Command and Control (C2). This technique for C2 still remains prevalent, but there has been an observed shift into threat actors using trusted services, like Slack, Discord, or Telegram for these communications.

Using trusted services allow malware to “hide in plain sight.” Network defenders typically whitelist or don’t scrutinize traffic to well-known platforms. By shifting C2 communications to these channels, attackers can bypass many conventional security controls and delay detection. The website [LOLC2](https://lolc2.github.io/) details a common list of legitimate services that can be abused by C2. There are some noteable entries in the list, including [CounterStrike 1.6](https://github.com/eversinc33/1.6-C2) or [Lichess](https://github.com/0x-Apollyon/Malnus-Carlware). These are more niche entries, developed for fun, but services like Telegram for C2 remains a prevalent threat that has begun to be abused widely, but a vast array of actors. 

This blog post highlights how we as defenders, or cyber-threat intelligence analysts, can exploit certain pitfalls in the way Telegram-based malware operates - in order to compromise C2 communications and disrupt adversaries. As a result of this research, I've discovered one particular actor who **stupidly** tested their own keylogging & infostealing malware on their own production "hacking" machine. From this, we can gain insight into this particular actors back-end infrastructure, including other cybercrime operations they are currently running.  

## Telegram for C2

Where Telegram C2 is used, network connections to `api.telegram[.]org` are observed from the malware, rather than network connections to a malicious domain. Each strain of malware that uses Telegram for C2 may operate differently, but we can generalise the kill chain to the below steps:

1. Bot Setup: The attacker registers a new bot via Telegram’s BotFather, receiving a unique token.

2. Malware Deployment: The malware, embedded with the bot token and possibly a unique identifier for the infected host, is distributed to victims.

3. Command Polling: Infected systems periodically make API requests to Telegram’s servers to check for new commands sent to the bot. The bot might reside in a private channel or group where only the attacker has posting rights.

4. Command Execution: Upon receiving a command, the malware executes instructions on the victim machine. These could range from downloading additional payloads to exfiltrating data.

5. Data Exfiltration: The malware may send results or stolen data back to the attacker via the same Telegram bot channel, completing the C2 loop. 

[![1](/assets/images/CompComms/telegram.jpg)](/assets/images/CompComms/telegram.jpg){: .full}

From my research, it appears the vast majority of malware samples (which use Telegram for C2), are infostealers or keyloggers - for the intent of stealing credentials, cookies & credit card information. Although there has been evidence that sophisticated actors, like the North Korean Lazarus Group have used [Telegram-based](https://blog.talosintelligence.com/lazarus_new_rats_dlang_and_telegram/) RATs, all the samples I've analysed can be attributed to low-tier cybercriminals or skids. 
 
## The Vulnerability

The 